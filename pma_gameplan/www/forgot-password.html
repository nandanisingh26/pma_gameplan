{% extends "templates/web.html" %}

{% block navbar %}{% endblock %}
{% block header %}{% endblock %}
{% block footer %}{% endblock %}

{% block page_content %}
<div class="pma-auth-wrapper">
  <div class="pma-auth-card">

    <h3 class="text-center mb-4">Reset your password</h3>

    <div class="form-group mb-3">
      <input
        type="email"
        id="fp-email"
        class="form-control"
        placeholder="Enter your company email"
        required
      >
    </div>

    <button class="btn btn-dark w-100" onclick="sendResetLink()">
      Send Reset Link
    </button>

    <div class="text-center mt-3">
      <a href="/pma-login">Back to login</a>
    </div>

  </div>
</div>

<style>
/* Full page centering */
.pma-auth-wrapper {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 16px;
}

/* Card */
.pma-auth-card {
  width: 100%;
  max-width: 420px;
  background: #fff;
  padding: 28px;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
}

/* Mobile tweaks */
@media (max-width: 480px) {
  .pma-auth-card {
    padding: 22px;
  }
}
</style>

<script>
function sendResetLink() {
  const email = document.getElementById("fp-email").value.trim();

  if (!email) {
    frappe.msgprint("Please enter your email");
    return;
  }

  // ðŸ”’ Company email restriction
  const allowedDomains = ["prettl.com"];
  const domain = email.split("@").pop().toLowerCase();

  if (!allowedDomains.includes(domain)) {
    frappe.msgprint("Use your company email only");
    return;
  }

  frappe.call({
    method: "frappe.core.doctype.user.user.reset_password",
    args: { user: email },
    callback() {
      frappe.msgprint(
        "If this email exists, a reset link has been sent."
      );
    }
  });
}
</script>
{% endblock %}